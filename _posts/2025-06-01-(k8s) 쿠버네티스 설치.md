---
title: (k8s) ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜
date: 2025-06-01 17:00:00 +0900
modified: 2025-06-01 17:57:00 +0900
categories:
  - ì¿ ë²„ë„¤í‹°ìŠ¤
tags:
  - ì¿ ë²„ë„¤í‹°ìŠ¤
pin: false
---

## ğŸ“ ì‘ì„± ë°°ê²½
ì¸í”„ëŸ°ì—ì„œ ì§„í–‰ ì¤‘ì¸ **ì›Œë°ì—… í´ëŸ½** ìŠ¤í„°ë””ì— ì°¸ì—¬í•˜ê³  ìˆëŠ”ë°, ì´ë²ˆ ì£¼ ë¯¸ì…˜ ì¤‘ í•˜ë‚˜ëŠ” **"ìì‹ ì˜ PCì— VMì„ í†µí•´ Linuxë¥¼ ì„¤ì¹˜í•˜ê³ , ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì§ì ‘ êµ¬ì„±í•´ë³´ëŠ” ê²ƒ"**ì´ì—ˆë‹¤.
ë¯¸ì…˜ì„ ì§„í–‰í•˜ë©´ì„œ ì—¬ëŸ¬ ê°€ì§€ ë¬¸ì œë“¤ì´ ë°œìƒí–ˆëŠ”ë°, ì´ë¥¼ í•´ê²°í–ˆë˜ ë°©ë²•ë“¤ì„ ê¸°ë¡í•´ë‘ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ ì´ ê¸€ì„ ì‘ì„±í•˜ê²Œ ë˜ì—ˆë‹¤.

ğŸš¨ `lima-vm` ì‚¬ìš© ë°©ë²•ì€ [ê³µì‹ ë¬¸ì„œ](https://lima-vm.io/)ë¥¼ ì°¸ê³ .

### PC í™˜ê²½
- OS: macOS 15.4.1 24E263 arm64
- CPU: Apple M3 Pro
- Memory: 36GB

### k8s
- Version: v1.30
- CRI: containerd(1.7.27-3.1.el9)
- CNI: Flannel

### Etc.
- VM: Lima-vm
- Linux: Rocky-9 (Red Hat ê³„ì—´)

## â˜¸ï¸ ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜

### Rocky Linux ê¸°ë³¸ ì„¤ì •
1. íƒ€ì„ì¡´ ì„¤ì • í™•ì¸
    - ì„¤ì • ëª…ë ¹ì–´: `timedatectl set-timezone Asia/Seoul`
    - í™•ì¸ ëª…ë ¹ì–´: `timedatectl`

```bash
[crispin@lima-linux crispin]$ timedatectl
               Local time: Sun 2025-06-01 18:00:11 KST
           Universal time: Sun 2025-06-01 09:00:11 UTC
                 RTC time: Sun 2025-06-01 09:00:12
                Time zone: Asia/Seoul (KST, +0900)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```
- íƒ€ì„ì¡´ í™•ì¸ ì‹œ ì´ë¯¸ `Asia/Seoul` ë˜ì–´ ìˆë‹¤ë©´ ë³„ë„ì˜ ì„¤ì •ì„ í•´ ì¤„ í•„ìš”ëŠ” ì—†ë‹¤. ë§Œì•½ ë‹¤ë¥¸ íƒ€ì„ì¡´ìœ¼ë¡œ ì„¤ì • ë˜ì–´ ìˆë‹¤ë©´ ì„¤ì • ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©

### Kubeadm ì„¤ì¹˜ ì „ ì‚¬ì „ì‘ì—…
1. ë°©í™”ë²½ í•´ì œ í™•ì¸
    - ì„¤ì • ëª…ë ¹ì–´: `systemctl stop firewalld && systemctl disable firewalld`
    - í™•ì¸ ëª…ë ¹ì–´: `systemctl status firewalld`

```bash
[crispin@lima-linux crispin]$ systemctl status firewalld
Unit firewalld.service could not be found.
```
- `lima-vm` ì„ ì‚¬ìš©í•´ì„œ `VM` ì„ ë„ìš°ëŠ” ê²½ìš° ë³„ë„ì˜ ì„¤ì •ì´ ì—†ë‹¤ë©´, ê²½ëŸ‰í™”ëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ `firewalld` ì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šë‹¤. ë§Œì•½ ë‹¤ë¥¸ `tool` ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ë¯¸ë¦¬ ì„¤ì •ì„ í†µí•´ ë°©í™”ë²½ì„ ì„¤ì¹˜ í–ˆë‹¤ë©´ ì‹¤ìŠµ í¸ì˜ìƒ ë°©í™”ë²½ì„ í•´ì œ ì‹œí‚¤ëŠ” í¸ì´ í¸í•˜ë‹¤.
2. ë©”ëª¨ë¦¬ `swap` ë¹„ í™œì„±í™” í™•ì¸
    - ì„¤ì • ëª…ë ¹ì–´: `swapoff -a && sed -i '/ swap / s/^/#/' /etc/fstab`
    - í™•ì¸ ëª…ë ¹ì–´: `free -h`, `cat /etc/fstab | grep swap`
- `free -h` ëª…ë ì–´

```bash
[crispin@lima-linux crispin]$ free -h
               total        used        free      shared  buff/cache   available
Mem:           7.5Gi       406Mi       6.1Gi       8.0Mi       1.1Gi       7.1Gi
Swap:             0B          0B          0B
```
- ë°©í™”ë²½ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ `lima-vm` ì„ ì‚¬ìš©í•˜ë©´ ë³„ë„ì˜ ì„¤ì •ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, `swap` ë©”ëª¨ë¦¬ ì„¤ì •ì´ ë˜ì–´ ìˆì§€ ì•Šë‹¤.

### CRI(container runtime interface) ì„¤ì¹˜
1. iptables ì„¸íŒ…
- ì„¤ì • ëª…ë ¹ì–´ [k8s docs](https://kubernetes.io/ko/docs/setup/production-environment/container-runtimes/#ipv4%EB%A5%BC-%ED%8F%AC%EC%9B%8C%EB%94%A9%ED%95%98%EC%97%AC-iptables%EA%B0%80-%EB%B8%8C%EB%A6%AC%EC%A7%80%EB%90%9C-%ED%8A%B8%EB%9E%98%ED%94%BD%EC%9D%84-%EB%B3%B4%EA%B2%8C-%ED%95%98%EA%B8%B0)

```bash
cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

# í•„ìš”í•œ sysctl íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•˜ë©´, ì¬ë¶€íŒ… í›„ì—ë„ ê°’ì´ ìœ ì§€ëœë‹¤.
cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

# ì¬ë¶€íŒ…í•˜ì§€ ì•Šê³  sysctl íŒŒë¼ë¯¸í„° ì ìš©í•˜ê¸°
sudo sysctl --system
```
- í™•ì¸ ëª…ë ¹ì–´: `cat /etc/modules-load.d/k8s.conf && cat /etc/sysctl.d/k8s.conf && lsmod | grep overlay && lsmod | grep br_netfilter`

```bash
[crispin@lima-linux crispin]$ cat /etc/modules-load.d/k8s.conf && cat /etc/sysctl.d/k8s.conf && lsmod | grep overlay && lsmod | grep br_netfilter
overlay
br_netfilter
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
overlay               176128  0
br_netfilter           32768  0
bridge                303104  1 br_netfilter
```

2. containerd.id ì„¤ì¹˜
- docker repo ì„¤ì • ëª…ë ¹ì–´: `yum install -y yum-utils` , `yum-config-manager --add-repo [https://download.docker.com/linux/centos/docker-ce.repo](https://download.docker.com/linux/centos/docker-ce.repo)`

```bash
[crispin@lima-linux crispin]$ sudo yum install -y yum-utils
Last metadata expiration check: 0:27:12 ago on Sun 01 Jun 2025 05:56:20 PM KST.
Package yum-utils-4.3.0-16.el9.noarch is already installed.
Dependencies resolved.
Nothing to do.
Complete!

[crispin@lima-linux crispin]$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
Adding repo from: https://download.docker.com/linux/centos/docker-ce.repo
```
- docker repo ì„¤ì • í™•ì¸ ëª…ë ¹ì–´: `yum repolist enabled`

```bash
[crispin@lima-linux crispin]$ yum repolist enabled
repo id                     repo name
appstream                   Rocky Linux 9 - AppStream
baseos                      Rocky Linux 9 - BaseOS  
docker-ce-stable            Docker CE Stable - aarch64
extras                      Rocky Linux 9 - Extras
```
- ì„¤ì¹˜ ê°€ëŠ¥í•œ ë²„ì „ì˜ containerd.io ë¦¬ìŠ¤íŠ¸ í™•ì¸ ëª…ë ¹ì–´: `yum list containerd.io --showduplicates | sort -r`

```bash
[crispin@lima-linux crispin]$ yum list containerd.io --showduplicates | sort -r
Rocky Linux 9 - Extras                           14 kB/s |  17 kB     00:01
Rocky Linux 9 - BaseOS                          2.3 MB/s | 2.5 MB     00:01
Rocky Linux 9 - AppStream                       8.6 MB/s | 7.4 MB     00:00
Docker CE Stable - aarch64                      704 kB/s |  71 kB     00:00
containerd.io.aarch64              1.7.27-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.26-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.25-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.24-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.23-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.22-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.21-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.20-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.19-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.7.18-3.1.el9               docker-ce-stable
containerd.io.aarch64              1.6.9-3.1.el9                docker-ce-stable
# ...
```
- containerd ì„¤ì¹˜ ëª…ë ¹ì–´: `yum install -y containerd.io-{version}`
    - `containerd` ë²„ì „ì— ë”°ë¥¸ `k8s` í˜¸í™˜ì„± ì •ë³´ í™•ì¸ì€ í•´ë‹¹ [í˜ì´ì§€](https://github.com/containerd/containerd/blob/main/RELEASES.md)ë¥¼ ì°¸ê³ 
    - í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” `1.7.27-3.1.el9` ë²„ì „ì„ ì„¤ì¹˜

- containerd ì„¤ì¹˜ í™•ì¸ ëª…ë ¹ì–´: `systemctl status containerd`

```bash
[crispin@lima-linux crispin]$ systemctl status containerd
â—‹ containerd.service - containerd container runtime
     Loaded: loaded (/usr/local/lib/systemd/system/containerd.service; disabled; preset: disabled)
     Active: inactive (dead)
       Docs: https://containerd.io
```
- ì—¬ê¸°ì„œë¶€í„° ë­”ê°€ ì¡°ê¸ˆì”© ë‹¬ë¼ì§€ëŠ” ë¶€ë¶„ì´ ë°œìƒí•œë‹¤. ìš°ì„  `Active` ìƒíƒœê°€ `active (running)` ìƒíƒœê°€ ì•„ë‹Œ `inactive (dead)`  ìƒíƒœë¡œ ë˜ì–´ ìˆë‹¤. ê·¸ë¦¬ê³  `/usr/local/lib/systemd/system/containerd.service` ê°€ `disabled` ë¡œ ë˜ì–´ ìˆë‹¤.
- ìœ„ ë‘ê°€ì§€ ë¶€ë¶„ì— ëŒ€í•´ ë³„ë„ë¡œ ê²€ìƒ‰í•´ë³´ê³  ìˆ˜ì •ì„ í–ˆì–´ì•¼ í–ˆë‹¤. ê·¸ëŸ¼ í•´ê²° ë°©ë²•ì„ ë³´ì.
    - `inactive (dead)` ìƒíƒœ
        - ì›ì¸: `containerd` ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ ë³„ë„ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰ì‹œì¼œì•¼ í•¨.
        - ëª…ë ¹ì–´
            - containerd ì‹¤í–‰ ëª…ë ¹ì–´: `sudo systemctl enable containerd`
            - ë¶€íŒ… ì‹œ ìë™ ì‹œì‘ ì„¤ì • ëª…ë ¹ì–´: `sudo systemctl enable containerd`
    - `disabled` ìƒíƒœ
        - ì›ì¸: ì„œë¹„ìŠ¤ íŒŒì¼ì´ ì¼ë°˜ì ì´ ê²½ë¡œê°€ ì•„ë‹ ê²½ìš° `systemd` ê°€ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œ
        - ëª…ë ¹ì–´
            - ë°ëª¬ ë¦¬ë¡œë“œ: `sudo systemctl daemon-reload`
            - ì„œë¹„ìŠ¤ í™œì„±í™”: `sudo systemctl enable containerd.service`
            - ì„œë¹„ìŠ¤ ì‹œì‘: `sudo systemctl start containerd.service`
            
```bash
[crispin@lima-linux crispin]$ sudo systemctl daemon-reload
[crispin@lima-linux crispin]$ sudo systemctl enable containerd.service
Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service â†’ /usr/local/lib/systemd/system/containerd.service.
[crispin@lima-linux crispin]$ sudo systemctl start containerd.service
[crispin@lima-linux crispin]$ sudo systemctl status containerd.service
â— containerd.service - containerd container runtime
     Loaded: loaded (/usr/local/lib/systemd/system/containerd.service; enabled; preset: disabled)
     Active: active (running) since Sun 2025-06-01 18:32:59 KST; 4min 23s ago
       Docs: https://containerd.io
   Main PID: 15871 (containerd)
      Tasks: 9
     Memory: 14.0M
        CPU: 441ms
     CGroup: /system.slice/containerd.service
             â””â”€15871 /usr/local/bin/containerd
# ...
```
- ìƒíƒœì™€ ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ëœ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.

### CRI(container runtime interface) í™œì„±í™”
1. cri ì„¤ì • í™•ì¸ í™œì„±í™”
- í™œì„±í™” ëª…ë ¹ì–´: `sudo sh -c 'containerd config default > /etc/containerd/config.toml && sed -i "s/ SystemdCgroup = false/ SystemdCgroup = true/" /etc/containerd/config.toml'`
- ì„¤ì • í™•ì¸ ëª…ë ¹ì–´: `cat /etc/containerd/config.toml`

```bash
[crispin@lima-linux crispin]$ cat /etc/containerd/config.toml | grep SystemdCgroup
            SystemdCgroup = true
```

### Kubeadm ì„¤ì¹˜
1. repo ì„¤ì • í™•ì¸
- repo ì„¤ì • ëª…ë ¹ì–´ ([ëª…ë ¹ì–´ ì°¸ê³  ë¬¸ì„œ](https://kubernetes.io/ko/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#kubeadm-kubelet-%EB%B0%8F-kubectl-%EC%84%A4%EC%B9%98))

```bash
cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
enabled=1
gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF

# permissive ëª¨ë“œë¡œ SELinux ì„¤ì •(íš¨ê³¼ì ìœ¼ë¡œ ë¹„í™œì„±í™”)
sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

sudo systemctl enable --now kubelet
```
- ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ `repo` ë¥¼ ì„¤ì • í•˜ëŠ” ê²½ìš°
```bash
Errors during downloading metadata for repository 'kubernetes':
  - Status code: 404 for https://packages.cloud.google.com/yum/repos/kubernetes-el7-aarch64/repodata/repomd.xml (IP: 142.251.42.206)
Error: Failed to download metadata for repo 'kubernetes': Cannot download repomd.xml: Cannot download repodata/repomd.xml: All mirrors were tried
Failed to enable unit: Unit file kubelet.service does not exist.
```
- í•´ë‹¹ ì—ëŸ¬ê°€ ë°œìƒ í•œë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ì›ì¸ì€ Google Cloudì˜ ê¸°ì¡´ Kubernetes íŒ¨í‚¤ì§€ ì €ì¥ì†Œê°€ deprecatedë˜ì–´ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¡œ íŒ¨í‚¤ì§€ ì €ì¥ì†Œì˜ ë§í¬ë¥¼ ë³€ê²½í•´ì£¼ë©´ ëœë‹¤.

```bash
# 1. ê¸°ì¡´ ì €ì¥ì†Œ íŒŒì¼ ì œê±°
sudo rm -f /etc/yum.repos.d/kubernetes.repo

# 2. ìƒˆë¡œìš´ ì €ì¥ì†Œ ì¶”ê°€
cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://pkgs.k8s.io/core:/stable:/{version}/rpm/
enabled=1
gpgcheck=1
gpgkey=https://pkgs.k8s.io/core:/stable:/{version}/rpm/repodata/repomd.xml.key
exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni
EOF

# 3. permissive ëª¨ë“œë¡œ SELinux ì„¤ì •(íš¨ê³¼ì ìœ¼ë¡œ ë¹„í™œì„±í™”)
sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

# 4. íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

# 5. kubelet ì„œë¹„ìŠ¤ í™œì„±í™”
sudo systemctl enable --now kubelet
```
- `version` ì— ì„¤ì¹˜í•˜ê³  ì‹¶ì€ `k8s` ë²„ì „ì„ ê¸°ì…í•˜ë©´ í•´ë‹¹ ë²„ì „ìœ¼ë¡œ ì„¤ì¹˜ í•  ìˆ˜ ìˆë‹¤.
- í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” `v1.30` ë²„ì „ì„ ì„¤ì¹˜

2. repo ì„¤ì • ì¶”ê°€ í™•ì¸

```bash
[crispin@lima-linux crispin]$ yum repolist enabled
repo id                     repo name
appstream                   Rocky Linux 9 - AppStream
baseos                      Rocky Linux 9 - BaseOS  
docker-ce-stable            Docker CE Stable - aarch64
extras                      Rocky Linux 9 - Extras
kubernetes                  Kubernetes
```
- `Kubernetes` ê°€ ì¶”ê°€ë˜ì–´ ìˆëŠ”ê±¸ í™•ì¸

3. SELinux ì„¤ì • í™•ì¸
- ì„¤ì • í™•ì¸ ëª…ë ¹ì–´: `cat /etc/selinux/config | grep SELINUX && sestatus`

```bash
[crispin@lima-linux crispin]$ cat /etc/selinux/config | grep SELINUX && sestatus
SELINUX=permissive # í•´ë‹¹ ì„¤ì • í™•ì¸
SELINUXTYPE=targeted
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   permissive # í•´ë‹¹ ì„¤ì • í™•ì¸
Mode from config file:          permissive # í•´ë‹¹ ì„¤ì • í™•ì¸
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Memory protection checking:     actual (secure)
Max kernel policy version:      33
```

5. kubelet, kubeadm, kubectl íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸
- kubeadm ì„¤ì¹˜ í™•ì¸ ëª…ë ¹ì–´: `kubeadm version`

```bash
[crispin@lima-linux crispin]$ kubeadm version
kubeadm version: &version.Info{Major:"1", Minor:"30", GitVersion:"v1.30.13", GitCommit:"50af91c466658b6a33d123fae8a487db1630971c", GitTreeState:"clean", BuildDate:"2025-05-15T09:55:10Z", GoVersion:"go1.23.8", Compiler:"gc", Platform:"linux/arm64"}
```
- kubelet ì„¤ì§€ í™•ì¸ ëª…ë ¹ì–´: `systemctl status kubelet`

```bash
[crispin@lima-linux crispin]$ systemctl status kubelet
â— kubelet.service - kubelet: The Kubernetes Node Agent
     Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; preset: disabled)
    Drop-In: /usr/lib/systemd/system/kubelet.service.d
             â””â”€10-kubeadm.conf
     Active: activating (auto-restart) (Result: exit-code) since Sun 2025-06-01 19:20:51 KST; 8s ago
       Docs: https://kubernetes.io/docs/
    Process: 18604 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS (code=exited, status=1/FAILURE)
   Main PID: 18604 (code=exited, status=1/FAILURE)
        CPU: 61ms
```
- kubectl ì„¤ì§€ í™•ì¸ ëª…ë ¹ì–´: `kubectl version`

```bash
[crispin@lima-linux crispin]$ kubectl version
Client Version: v1.30.13
Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3
The connection to the server localhost:8080 was refused - did you specify the right host or port?
```
- íŒ¨í‚¤ì§€ ì„¤ì • í™•ì¸ ì‹œ `kubelet` ì´ ì§€ì†ì ìœ¼ë¡œ ì¬ ì‹¤í–‰ ë˜ëŠ” ë¶€ë¶„ì´ í™•ì¸ ë  ìˆ˜ ìˆëŠ”ë° ì´ê±´ `kubeadm` ì´ ì•„ì§ `init` ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ë¬¸ì œë¡œ `kubeadm init` ì´í›„ í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•˜ë©´ í•´ê²°ëœë‹¤.
- `kubectl` ì—ì„œ ë³´ì´ëŠ” `refused` ì´í›„ `kubectl` ì— ì¶”ê°€ì ì¸ ì„¤ì •ì„ í•´ì£¼ë©´ í•´ê²°ëœë‹¤.
- ìœ„ ë‘ê°€ì§€ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ì•„ë˜ì—ì„œ ë‹¤ë£° ì˜ˆì •ì´ë‹¤.

### Kubeadm ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„±
1. pod network ì„¸íŒ…
- ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸ ëª…ë ¹ì–´: `ip route show && ip addr show`

```bash
default via xxx.xxx.xxx.1 dev eth0 proto dhcp src {ip} metric 100  
xxx.xxx.xxx.0/24 dev eth0 proto kernel scope link src xxx.xxx.xxx.xxx metric 100  

1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000  
    link/loopback xx:xx:xx:xx:xx:xx brd xx:xx:xx:xx:xx:xx  
    inet 127.0.0.1/8 scope host lo  
       valid_lft forever preferred_lft forever  
    inet6 ::1/128 scope host  
       valid_lft forever preferred_lft forever  

2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000  
    link/ether xx:xx:xx:xx:xx:xx brd xx:xx:xx:xx:xx:xx  
    altname enxxxxxx  
    inet xxx.xxx.xxx.xxx/24 brd xxx.xxx.xxx.255 scope global dynamic noprefixroute eth0  
       valid_lft 3121sec preferred_lft 3121sec  
    inet6 xxxx:xxxx:xxxx::xxxx/64 scope link  
       valid_lft forever preferred_lft forever  
```
- `{ip}`  ë¸”ë¡ì— ìˆëŠ” `ip` ì£¼ì†Œ í™•ì¸

2. í´ëŸ¬ìŠ¤í„° ì´ˆê¸°í™”
- í´ëŸ¬ìŠ¤í„° ì´ˆê¸°í™” ëª…ë ¹ì–´: `kubeadm init --pod-network-cidr={cidr} --apiserver-advertise-address {ip}`
- `cidr` ì€ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” `CNI` ì— ëŒ€í•œ ê¸°ë³¸ ê°’ì„ ì‚¬ìš©í•´ë„ ë˜ê³  ë³„ë„ë¡œ ì„¤ì •í•´ì¤˜ë„ ëœë‹¤.
- í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” `Flannel` ë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì´ë©°, `Flannel` ì˜ `cidr` ê¸°ë³¸ê°’ì€ `10.244.0.0/16` ì´ë‹¤.

3. í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
- í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸ ëª…ë ¹ì–´: `kubectl get node`

```bash
[crispin@lima-linux crispin]$ kubectl get node
E0601 20:04:33.891690   22662 memcache.go:265] couldn't get current server API group list: Get "http://localhost:8080/api?timeout=32s": dial tcp [::1]:8080: connect: connection refused
The connection to the server localhost:8080 was refused - did you specify the right host or port?
```
- í´ëŸ¬ìŠ¤í„° í™•ì¸ ì‹œ ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œë˜ë©´ ì¶”ê°€ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.
- ì„¤ì • ëª…ë ¹ì–´

```bash
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```
- í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ `config` ë¥¼ ì¶”ê°€í•´ì£¼ê³  ë‹¤ì‹œ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´

```bash
[crispin@lima-linux crispin]$ kubectl get nodes
NAME         STATUS     ROLES           AGE     VERSION
lima-linux   NotReady   control-plane   2m48s   v1.30.13
```
- ìƒì„±ëœ `node` ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- `node` ê°€ `NotReady` ìƒíƒœì¸ ì´ìœ ëŠ” ì•„ì§ `CNI` í”ŒëŸ¬ê·¸ì¸ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë©°, í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•´ì£¼ë©´ `Read` ìƒíƒœë¡œ ë³€ê²½ëœë‹¤.
- `CNI` í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ëª…ë ¹ì–´

```bash
[crispin@lima-linux crispin]$ kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml
namespace/kube-flannel created
serviceaccount/flannel created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
configmap/kube-flannel-cfg createdkubectl cluster-info dump | grep -m 1 cluster-cidr
daemonset.apps/kube-flannel-ds created
```
- ì„¤ì¹˜í•˜ê³  1ë¶„ì •ë„ ì‹œê°„ì´ ì§€ë‚œ ì´í›„ì— ë‹¤ì‹œ `kubectl get nodes` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ `Ready` ìƒíƒœë¡œ ë³€ê²½ëœë‹¤.

```bash
[crispin@lima-linux crispin]$ kubectl get nodes
NAME         STATUS   ROLES           AGE   VERSION
lima-linux   Ready    control-plane   99s   v1.30.13
```

4. Masterì— pod ë¥¼ ìƒì„± í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •(Optional)
- ì„¤ì • ëª…ë ¹ì–´: `kubectl taint nodes {node_name} node-role.kubernetes.io/control-plane-`

```bash
[crispin@lima-linux crispin]$ kubectl taint nodes lima-linux node-role.kubernetes.io/control-plane-
node/lima-linux untainted
```
- í™•ì¸ ëª…ë ¹ì–´: `kubectl describe nodes | grep Taints`

```bash
[crispin@lima-linux crispin]$ kubectl describe nodes | grep Taints
Taints:             <none> # í•´ë‹¹ ì„¤ì • í™•ì¸
```

### ì¿ ë²„ë„¤í‹°ìŠ¤ í¸ì˜ ê¸°ëŠ¥ ì„¤ì¹˜
1. kubectl ìë™ ì™„ì„± ê¸°ëŠ¥ ì¶”ê°€

```bash
source <(kubectl completion bash)
alias k=kubectl
complete -o default -F __start_kubectl k
```
- í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ `k get pods` ì²˜ëŸ¼ `kubectl` ì„ `k` ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ì¶”ê°€ì ìœ¼ë¡œ `tap` ì„ í†µí•´ ìë™ì™„ì„±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```bash
[crispin@lima-linux crispin]$ k get nodes
NAME         STATUS   ROLES           AGE   VERSION
lima-linux   Ready    control-plane   18m   v1.30.13
[crispin@lima-linux crispin]$ k get bash: _get_comp_words_by_ref: command not found
```
- `k` ëŠ” ì‚¬ìš©ì´ ê°€ëŠ¥í•œë° ìë™ì™„ì„±ì„ ìœ„í•´ `tap` ì„ ëˆŒë ¸ì„ë•Œ ìœ„ ì²˜ëŸ¼ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ”ë° `bash-completion` íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì•„ ë°œìƒí•˜ëŠ” ë¬¸ì œë¡œ í•´ë‹¹ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ë©´ ëœë‹¤.
- íŒ¨í‚¤ì§€ ì„¤ì¹˜ ëª…ë ¹ì–´: `sudo yum install -y bash-completion`

```bash
sudo yum install -y bash-completion # ëª…ë ¹ì–´ ì„¤ì¹˜
source /etc/profile.d/bash_completion.sh # ìƒˆë¡œê³ ì¹¨
```
- í•´ë‹¹ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì´í›„ ìƒˆë¡œê³ ì¹¨ì„ í•˜ë©´ ìë™ì™„ì„±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

---

## ğŸ’¡ ë§ˆë¬´ë¦¬
í˜„ì—…ì—ì„œ `kubernetes` ë¥¼ ì§€ê¸ˆë„ ì‚¬ìš©í•˜ê³  ìˆê³ , ìì£¼ í™œìš©í•˜ê³  ìˆëŠ”ë° ì§ì ‘ `linux` ì— `kubernetes` ë¥¼ ì„¤ì¹˜í•œ ê²½í—˜ì€ ì²˜ìŒì´ë¼ í¥ë¯¸ë¡œìš´ ê²½í—˜ì´ì˜€ë‹¤. ë§¤ë²ˆ í´ë¼ìš°ë“œì—ì„œ ì œê³µë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ í†µí•´ì„œ ì‚¬ìš©í•˜ê±°ë‚˜ ì´ë¯¸ íšŒì‚¬ì˜ ì˜¨í”„ë ˆë¯¸ìŠ¤ ì„œë²„ì— ì„¤ì¹˜ ë˜ì–´ ìˆëŠ” `kubernetes` ë¥¼ ì‚¬ìš©í•˜ê¸°ë§Œ í–ˆëŠ”ë° ì§ì ‘ ì„¤ì¹˜í•˜ê³  ì‚¬ìš©í•´ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ì„¤ì¹˜ ê³¼ì •ì´ ì‰½ì§€ ë§ì€ ì•Šê²Œ ëŠê»´ì¡Œë‹¤.

ê°•ì˜ë¥¼ ì°¸ê³ í•˜ê³ , ë°œìƒí•˜ëŠ” ì—ëŸ¬ëŠ” ê²€ìƒ‰ì„ í•˜ë©´ì„œ ì§„í–‰í–ˆëŠ”ë°, ê°•ì˜ì—ì„œ ì•ˆë‚´í•´ì£¼ëŠ” `tool` ì„ ì‚¬ìš©í•œê²ƒë„ ì•„ë‹ˆê³  ì•„í‚¤í…ì²˜ë„ ë‹¤ë¥´ë‹¤ ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ì˜¤ë˜ê±¸ë¦¬ê¸°ëŠ” í–ˆëŠ”ë° ì„¤ì¹˜í•˜ê³  ë‚˜ì„œ `pod` ë¥¼ ì§ì ‘ ë„ìš°ê³  ì¡°íšŒí•˜ë©´ì„œ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ” ëª¨ìŠµì„ ë³´ë©° ë§¤ìš° ë¿Œë“¯í•¨ì„ ëŠê¼ˆë‹¤.

---
## ğŸ”– REFERENCE
- [ì¿ ë²„ë„¤í‹°ìŠ¤ ì–´ë‚˜ë” í´ë˜ìŠ¤ (ì§€ìƒí¸) - Sprint 1, 2](https://www.inflearn.com/course/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EC%96%B4%EB%82%98%EB%8D%94-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%A7%80%EC%83%81%ED%8E%B8-sprint1/dashboard)